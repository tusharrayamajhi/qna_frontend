<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Chat Interface</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-4 max-w-4xl">
        <!-- URL Input Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">Add URLs</h2>
            <div id="urlContainer">
                <div class="url-input-group mb-3 flex items-center gap-2">
                    <input type="url" class="url-input w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Enter URL">
                </div>
            </div>
            <div class="flex gap-4">
                <button onclick="addUrlInput()" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors">
                    <span class="mr-2">+</span>Add URL
                </button>
                <button onclick="submitUrls()" class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition-colors">
                    Submit URLs
                </button>
            </div>
        </div>

        <!-- Chat Section -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-semibold mb-4">Chat</h2>
            <div id="chatContainer" class="h-96 overflow-y-auto mb-4 p-4 border rounded-md">
                <!-- Chat messages will appear here -->
            </div>
            <div class="flex gap-2">
                <input type="text" id="questionInput" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Type your question...">
                <button onclick="sendQuestion()" class="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors">
                    Send
                </button>
            </div>
        </div>
    </div>

    <script>
        function addUrlInput() {
            const container = document.getElementById('urlContainer');
            const inputGroup = document.createElement('div');
            inputGroup.className = 'url-input-group mb-3 flex items-center gap-2';
            inputGroup.innerHTML = `
                <input type="url" class="url-input w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Enter URL">
                <button onclick="removeUrlInput(this)" class="text-red-500 hover:text-red-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            `;
            container.appendChild(inputGroup);
        }

        function removeUrlInput(button) {
            button.parentElement.remove();
        }

        function addMessage(content, isUser = false) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `mb-4 ${isUser ? 'text-right' : 'text-left'}`;
            messageDiv.innerHTML = `
                <div class="${isUser ? 'bg-blue-500 text-white ml-auto' : 'bg-gray-200'} inline-block rounded-lg px-4 py-2 max-w-[80%]">
                    ${content}
                </div>
            `;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showLoading() {
            const chatContainer = document.getElementById('chatContainer');
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loadingIndicator';
            loadingDiv.className = 'flex items-center space-x-2 mb-4';
            loadingDiv.innerHTML = `
                <div class="flex space-x-1">
                    <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce"></div>
                    <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                    <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
                </div>
            `;
            chatContainer.appendChild(loadingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideLoading() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (loadingIndicator) {
                loadingIndicator.remove();
            }
        }

        async function submitUrls() {
            const urls = Array.from(document.querySelectorAll('.url-input')).map(input => input.value);
            showLoading();
            try {
                console.log(urls)
                const response = await fetch('http://localhost:3000/urls', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ urls }),
                });
                const data = await response.json();
                if(response.status == 400){
                    hideLoading();
                    addMessage('Error submitting URLs: ' + data.message);
                }
                else{
                    hideLoading();
                    addMessage('URLs submitted successfully');
                }
                
            } catch (error) {
                hideLoading();
                addMessage('Error submitting URLs: ' + error.message);
            }
        }

        async function sendQuestion() {
            const questionInput = document.getElementById('questionInput');
            const question = questionInput.value.trim();
            
            if (!question) return;

            addMessage(question, true);
            questionInput.value = '';
            showLoading();

            try {
                const response = await fetch('http://localhost:3000/question', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ question }),
                });
                const data = await response.json();
                hideLoading();
                addMessage(data.response);
            } catch (error) {
                hideLoading();
                addMessage('Error: ' + error.message);
            }
        }

        // Allow sending message with Enter key
        document.getElementById('questionInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendQuestion();
            }
        });
    </script>
</body>
</html> 